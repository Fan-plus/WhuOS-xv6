# 实验一说明
特权级指令＆控制寄存器（csr）
- `mstatus`
    - m态的异常状态寄存器，它指示发生异常的种类
- `mepc`
    - 异常的pc值将存入此寄存器
- `mtvec`
    - 中断处理程序的入口地址将存入这个寄存器
    - 上述三个寄存器与中断相关机制的说明位于risc-v手册10.3（p103）中有介绍，同时s态相关的原理在xv6的手册中有解释[4.1 RISC-V陷入机制 · 6.S081 All-In-One](https://xv6.dgs.zone/tranlate_books/book-riscv-rev1/c4/s1.html)
- `satp`
    - satp可以理解为页表（Supervisor Address Translation and Protection），在开启虚拟化后通常会把页表的地址写入此寄存器，此后硬件设备mmu会自动用此页表进行转译。在机器启动时不使用虚拟内存，即所有内存都在物理地址上直接映射，此时satp设置为0.
- `medeleg`异常委托寄存器
- `mideleg`中断委托寄存器
    - 当处理器支持S模式时，必须实现mideleg和medeled寄存器，如果不支持S模式就不要实现；写入这些寄存通常是产生硬件异常时统一使用内核态对中断进行处理，比如xv6中就是全部将使用kerneltrap统一处理产生的所有异常。虽然启动阶段不会用到，但是后面使用的中断都会在进入s态后统一处理。
    - 但是中断委托不能把M模式产生的中断委托给S模式。举例：把非法指令异常委托给S模式处理，S模式和M模式下发生的非法指令由S模式处理，而不再用M模式处理；但是M模式发生的非法指令异常，还是需要由M模式处理，不会交由S模式处理。
- `sie`（Supervisor InterruptEnable，监管者中断使能）和 `sip`（Supervisor Interrupt Pending，监管者中断待处理）
    - 是 S 模式的控制状态寄存器，他们是 mie 和 mip 的子集。它们有着和 M 模式下相同的布局，但在 sie 和 sip 中只有与由 mideleg 委托的中断对应的位才能读写。那些没有被委派的中断对应的位始终为零。
    - 对于此寄存器以及中断的操作在手册p108中有介绍。本实验中要求理解即可。
- `pmpaddr0`
    - 物理内存保护地址0~N，这样的寄存器有N个，用于PMP方案，允许 M 模 式指定 U 模式可以访问的内存地址。处于 U 模式的处 理器尝试取指或执行 load 或 store 操作时，将地址和所有的 PMP 地址寄存器比较。如果地 址大于等于 PMP 地址 i，但小于 PMP 地址 i+1，则 PMP i+1 的配置寄存器决定该访问是否 可以继续，如果不能将会引发访问异常
- `pmpcfg0`
    - 在上述的PMP方案中，`pmpcfg<x>`寄存器用于指定 PMP 表项的权限配置寄存器，每个`pmpcfg<x>`寄存器可以管理四个PMP 表项目
- `mhartid`
    - 硬件线程标识符在多核处理器中，每个核心可能有一个或多个硬件线程，每个硬件线程都有一个唯一的 hartid。在多核处理器中，每个核心（或硬件线程）都有自己独立的一套寄存器集。这意味着如果有两个核心，每个核心有 32 个通用寄存器，那么整个处理器实际上会有 64 个通用寄存器。每个核心的寄存器集是独立的，互不干扰。
- `tp`
    - 不属于csr，是通用寄存器之一（x4）：x4寄存器是RISC-V架构中的通用寄存器之一，通常用于存储线程指针（thread pointer），也称为线程局部存储器指针（thread-local storage pointer）。
    - 在线程级别的编程中，线程指针是一个非常重要的概念。它是一个指针，指向当前线程的局部存储器（thread-local storage），也就是线程私有的数据区域。在多线程编程中，每个线程都有自己独立的线程指针，并且可以在其对应的局部存储器中存储和管理线程私有的数据。
    - 本实验中此寄存器用于存储cpu的硬件线程，可以区分多核时不同cpu执行的线程
### 特权级指令
- `mret`机器态的返回。mret 将 PC 设置为 mepc，通过将 mstatus 的 MPIE 域复制到 MIE 来恢复之前的中断使能设置，并将权限模式设置为 mstatus 的 MPP 域中的值。 这基本是前一段中描述的逆操作。
- `csrr/csrw`读/写控制状态寄存器
- `csrrw `读后写控制状态寄存器
- 遇到没见过的可以看手册最后的附录p115指令列表